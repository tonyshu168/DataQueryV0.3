angular.module("dataQuery",["ng"]).controller("mainCtrl",["$scope","$rootScope","$http","$interval","$timeout",function(j,g,f,e,c){j.change=function(){$("#changePwd").show(500)};j.resetPwd=function(){$("#resetPwd").show(500)};j.$watch("uname",function(){g.uname=j.uname});j.close=function(){$("#changePwd").hide(500)};j.closeAlert=function(){$("#selectAlert").fadeOut(500)};j.refresh=function(){!j.pager&&(j.pager=true);if(j.uname!="apy"){f.get("data/getProducts_pager.php?name="+g.uname+"&pno=1").success(function(k){j.arrSort(k.data["products"],"effectiveDate");j.products=k.data["products"];g.products=j.products;k.page_count>1&&j.createBtn(k,1);j.pagerClick()});f.get("data/getProducts.php?name="+g.uname).success(function(k){g.total=j.getInstallTotal(k)});$("#addEdit").css("display","none")}else{f.get("data/getAllProducts_pager.php?pno=1").success(function(m){j.arrSort(m.data["products"],"effectiveDate");j.products=m.data["products"];g.products=j.products;g.total=j.getInstallTotal(j.products);for(var l=0;l<j.products.length;l++){g.oldProducts[l]={};for(var k in j.products[l]){g.oldProducts[l][k]=j.products[l][k]}}m.page_count>1&&j.createBtn(m,1);j.pagerClick();f.get("data/getAllProducts.php").success(function(n){g.total=j.getInstallTotal(n)})})}j.clearSearchHistroy()};j.search=function(){j.pager=false;if(g.uname=="apy"){if(j.productName||j.channelNum||j.company||j.coopType||j.effectiveDate||j.endDate){a();var m="productName="+j.productName+"&channelNum="+j.channelNum+"&company="+j.company+"&cooperateType="+j.coopType+"&effectiveDate="+(j.effectiveDate?j.effectiveDate.getTime():"")+"&endDate="+(j.endDate?j.endDate.getTime():"");f.get("data/newSelectDataV2.php?"+m).success(function(n){j.arrSort(n,"effectiveDate");j.products=n;j.total=j.getInstallTotal(j.products);if(!n.length){console.log("没查找到符合你要求的数据!!");$("#selectAlert").fadeIn(500)}})}}else{if(j.productName||j.channelNum||j.company||j.cooperateType||j.effectiveDate||j.endDate){if(j.effectiveDate){var l=j.effectiveDate.getTime()}else{var l=""}if(j.endDate){var k=j.endDate.getTime()}else{var k=""}a();var m=j.productName+"&channelNum="+j.channelNum+"&company="+j.company+"&cooperateType="+j.coopType+"&uname="+j.uname+"&effectiveDate="+l+"&endDate="+k;f.get("data/newSelectData_self.php?productName="+m).success(function(n){j.arrSort(n,"effectiveDate");j.products=n;g.total=j.getInstallTotal(j.products);if(!n.length){console.log("没查找到符合你要求的数据!!");$("#selectAlert").fadeIn(500)}})}}};function a(){if(!j.productName){j.productName=""}if(!j.channelNum){j.channelNum=""}if(!j.company){j.company=""}if(!j.coopType){j.coopType=""}}j.addRows=function(){if(g.uname=="apy"){$("#editContent").show(500)}};j.jumpPage=function(k){window.open("editBack02.html?"+k)};j.index=0;j.openEditWindow=function(){j.index=this.$index;$("#editContent").show(500)};j.inputProductInfo=function(){$("#inputProductInfo").show(500)};j.delRow=function(){console.log(this.$index);if(confirm){j.products.splice(this.$index,1)}};j.reverseArr=function(){j.products.reverse()};function i(k){$.each(k,function(l){k[l].effectiveDate=new Date(k[l].effectiveDate)})}j.changeDate=function(l){var k=new Date(l*1);return k.toLocaleDateString().replace(/\//g,"-")};j.arrSort=function(o,n){for(var m=1;m<o.length;m++){for(var l=0,k={};l<o.length-m;l++){if(o[l][n]*1<o[l+1][n]*1){k=o[l];o[l]=o[l+1];o[l+1]=k}}}};var d={};$("#table-data").on("click","[sort-by]",function(l){var k=$(this).attr("sort-by");d[k]=d[k]||0;d[k]++;var m=d[k]%2;j.products.sort(function(o,n){if(k=="installCount"||k=="price"){return m?o[k]-n[k]:n[k]-o[k]}else{return m?o[k].localeCompare(n[k]):n[k].localeCompare(o[k])}});j.$apply()});$("#searchAppend").on("input",function(){j.products.forEach(function(l,k){l.isHide=false});$(this).find("[filter]").each(function(){var k=$(this).attr("filter");var l=this.value;j.products.forEach(function(n,m){n.isHide=n.isHide||(l&&(n.isHide=(n[k]||"").toLowerCase()!=(l||"").toLowerCase()))})});j.$apply()});e(function(){!j.pager&&(j.pager=true);if(j.uname!="apy"){f.get("data/getProducts_pager.php?name="+g.uname+"&pno=1").success(function(k){j.arrSort(k.data["products"],"effectiveDate");j.products=k.data["products"];g.products=j.products;k.page_count>1&&j.createBtn(k,1);j.pagerClick()});f.get("data/getProducts.php?name="+g.uname).success(function(k){g.total=j.getInstallTotal(k)});$("#addEdit").css("display","none")}else{f.get("data/getAllProducts_pager.php?pno=1").success(function(m){j.arrSort(m.data["products"],"effectiveDate");j.products=m.data["products"];g.products=j.products;g.total=j.getInstallTotal(j.products);g.oldProducts=null;for(var l=0;l<j.products.length;l++){g.oldProducts[l]={};for(var k in j.products[l]){g.oldProducts[l][k]=j.products[l][k]}}m.page_count>1&&j.createBtn(m,1);j.pagerClick();f.get("data/getAllProducts.php").success(function(n){g.total=j.getInstallTotal(n)})})}j.$apply()},1000*3600*2);j.editable=true;j.autoComplete="off";g.oldProducts=[];j.changeDis=function(){j.oldInstallCount=parseInt(this.data.installCount);j.editable=false;j.autocomplete="on"};j.saveEditData=function(k){if(j.editable==false){var l=/\d/g;if(l.test(j.products[k].installCount)){f.get("data/saveInstallCountV2.php?installCount="+j.products[k].installCount+"&productName="+j.products[k].productName+"&channelNum="+j.products[k].channelNum+"&company="+j.products[k].company+"&price="+j.products[k].price+"&did="+j.products[k].did).success(function(o){var p=$("#table-data tbody tr").eq(k);if(o=="Update Succ!"){console.log("修改成功");var n=p.css("background");p.css("background","#81E3D6");c(function(){p.css("background",n)},5000);j.total+=parseInt(j.products[k].installCount)-j.oldInstallCount}else{var m=p.css("color");p.css("color","#f00");c(function(){p.css("color",m);j.abandon(k)},5000)}})}else{console.log("输入的必须为数字!!")}}};j.abandon=function(k){if(!j.editable){var m=j.products[k].did;var l=h(m,j.oldProducts);j.products[k].installCount=g.oldProducts[l].installCount}};function h(l,m){for(var k=0;k<m.length;k++){if(m[k].did==l){return k}}}j.clearSearchHistroy=function(){console.log("clear");j.productName="";j.channelNum="";j.cooperateType="";j.company="";j.effectiveDate="";j.endDate=""};j.encipher=function(m){var l=m.split("");for(var k=0;k<l.length;k++){l[k]=l[k].charCodeAt()+6*(k+1)}return l.join(",")};j.decipher=function(m){var l=m.split(",");for(var k=0;k<l.length;k++){l[k]=String.fromCharCode(l[k]-6*(k+1))}return l.join("")};j.getInstallTotal=function(m){var l=null;for(var k=0;k<m.length;k++){l+=parseInt(m[k].installCount)}return l};j.pager=true;j.createBtn=function(l,k){$(".pager_custom").empty();$(".pager_custom").append('<li><a href = "#">上一页</a></li>');for(var m=1;m<=l.page_count;m++){if(m==k){$(".pager_custom").append('<li class = "active"><a href = "#">'+l.cur_page+"</a></li>")}else{$(".pager_custom").append('<li><a href = "#">'+m+"</a></li>")}}$(".pager_custom").append('<li><a href = "#">下一页</a></li>')};function b(l,k){if(l!="apy"){f.get("data/getProducts_pager.php?name="+l+"&pno="+k).success(function(m){j.arrSort(m.data["products"],"effectiveDate");j.products=null;g.products=null;j.products=m.data["products"];g.products=j.products})}else{f.get("data/getAllProducts_pager.php?pno="+k).success(function(m){j.arrSort(m.data["products"],"effectiveDate");j.products=null;g.products=null;j.products=m.data["products"];g.products=j.products})}}j.pagerClick=function(){$("ul.pager_custom >li > a").on("click",function(n){n.preventDefault();var m=n.target||n.srcElement;var k=$(m).parent().siblings(".active").children(0).html();var l=$("ul.pager_custom > li:last").prev().children(0).html();if(/\d/.test(m.innerHTML)){$(this).parent().addClass("active").siblings(".active").removeClass("active")}else{if(m.innerHTML=="上一页"&&k!="1"){$(m).parent().siblings(".active").removeClass("active").prev().addClass("active")}else{if(m.innerHTML=="下一页"&&k!=l){$(m).parent().siblings(".active").removeClass("active").next().addClass("active")}}}if(m.innerHTML=="上一页"&&(parseInt(k)>1)){b(j.uname,parseInt(k)-1)}else{if(m.innerHTML=="下一页"&&(parseInt(k)<parseInt(l))){b(j.uname,parseInt(k)+1)}else{if(parseInt(m.innerHTML)!=parseInt(k)){!isNaN(parseInt(m.innerHTML))&&b(j.uname,parseInt(m.innerHTML))}}}})};j.saveInputProductInfo=function(){var k=localStorage.products?JSON.parse(localStorage.products):"";console.log(k);if(!k.productName||k.productName.length<8){$.inArray(j.productName,k.productName)<0&&k.productName.push(j.productName)}if(!k.channelNum||k.channelNum.length<8){$.inArray(j.channelNum,k.channelNum)<0&&k.channelNum.push(j.channelNum)}if(!k.company||k.company.length<8){$.inArray(j.company,k.company)<0&&k.company.push(j.company)}if(!k.compAbbreviation||k.compAbbreviation.length<8){$.inArray(j.compAbbreviation,k.compAbbreviation)<0&&k.compAbbreviation.push(j.compAbbreviation)}localStorage.products=JSON.stringify(k)};autoAppendKW=function(){if(localStorage.products){var l="";var k=this.getAttribute("ng-model");var m=this;j.$watch(k,function(){var o=JSON.parse(localStorage.products);var p=o[k];for(var n in p){l+="<li>"+p[n]+"</li>"}!m.value&&(l="");$(m).next().html(l).show();$(m).next().children().on("click",function(){m.value=this.innerHTML;$(this).parent().hide();j.$apply();$("ul.autoAppend").html("")})})}}}]).controller("login",["$scope","$http","$rootScope",function(c,e,a){c.show=true;if(localStorage.uname){d()}c.verification=function(){e.get("data/verificationUserPwd.php?uname="+c.uname+"&pwd="+c.encipher(c.pwd)).success(function(f){if(f!="login succ!"){c.show=false}else{if(c.select==true){b(c.uname,c.pwd)}$("#login-container").hide(500);a.uname=c.uname;if(c.uname!="apy"){$("#self_company").hide();$("#other_user").show();e.get("data/getProducts_pager.php?name="+a.uname+"&pno=1").success(function(g){c.arrSort(g.data["products"],"effectiveDate");c.products=g.data["products"];a.products=c.products;g.page_count>1&&c.createBtn(g,1);c.pagerClick()});e.get("data/getProducts.php?name="+a.uname).success(function(g){a.total=c.getInstallTotal(g)});$("#addEdit").css("display","none")}else{e.get("data/getAllProducts_pager.php?pno=1").success(function(j){console.log("getData");c.arrSort(j.data["products"],"effectiveDate");c.products=j.data["products"];a.products=c.products;a.total=c.getInstallTotal(c.products);for(var h=0;h<c.products.length;h++){a.oldProducts[h]={};for(var g in c.products[h]){a.oldProducts[h][g]=c.products[h][g]}}j.page_count>1&&c.createBtn(j,1);c.pagerClick();e.get("data/getAllProducts.php").success(function(i){a.total=c.getInstallTotal(i)})})}}})};function b(f,g){window.localStorage.uname=f;window.localStorage.pwd=c.encipher(g);window.localStorage.loginTime=new Date().getTime()}function d(){var g=localStorage.uname;var i=c.decipher(localStorage.pwd);var f=localStorage.loginTime;var h=new Date().getTime();if((h-f)>1000*3600*24*7){localStorage.removeItem("uname");localStorage.removeItem("pwd")}else{c.uname=g;c.pwd=i}}}]).controller("changePwd",["$scope","$rootScope","$http",function(c,a,d){c.pwdAlert=true;c.oldPwdAlert="hidden";var b=true;c.$watch("uname",function(){});c.verificationOldPwd=function(){if(c.pwd){d.get("data/verificationUserPwd.php?uname="+c.uname+"&pwd="+c.encipher(c.pwd)).success(function(e){if(e!="login succ!"){c.oldPwdAlert="visible";b=false}else{c.oldPwdAlert="hidden"}})}};c.checkIpntPwd=function(){if(c.firstPwd!=c.secondPwd){c.pwdAlert=false}else{if(c.firstPwd.length>=6&&b){d.get("data/changePwd.php?uname="+c.uname+"&pwd="+c.encipher(c.secondPwd)).success(function(e){});$("#changePwd").hide(500);c.clearAllPwd()}}};c.clearAllPwd=function(){c.pwd="";c.firstPwd="";c.secondPwd=""}}]).controller("editContent",["$scope","$rootScope","$http",function(c,a,e){c.isShow="hidden";c.firstInsertIndex=[];c.newAddData=[];c.save=function(){var f={};console.log(c.cooperateType);d();if(c.productName&&c.channelNum&&c.company&&c.compAbbreviation&&c.cooperateType&&c.price&&c.effectiveDate&&c.endDate){if((c.effectiveDate.getTime()+1000*3600*24*365)<=c.endDate.getTime()&&/\d/g.test(parseInt(c.price))){e.get("data/insertData02.php?proName="+c.productName+"&channelName="+c.channelNum+"&company="+c.company+"&compabbr="+c.compAbbreviation+"&coopType="+c.cooperateType+"&price="+c.price+"&effeDate="+c.effectiveDate.getTime()+"&endDate="+c.endDate.getTime()).success(function(g){console.log(g);if(g.msg=="Insert Succ!"){c.isShow="visible";c.insertMsg="输入成功!!!";c.firstInsertIndex.push(g.did);e.get("data/returnNewAdd.php?did="+g.did).success(function(h){console.log(h);c.newAddData.push(h);c.products=c.newAddData})}else{c.isShow="visible";c.insertMsg="输入有误!!!"}})}else{c.isShow="visible";c.insertMsg="输入有误或格式不对!!"}}};c.close=function(){$("#editContent").hide(500)};function d(){switch(c.cooperateType){case"0":c.cooperateType="CPA";break;case"1":c.cooperateType="CPC";break;case"2":c.cooperateType="CPI";break;case"3":c.cooperateType="CPT";break}}function b(){var f=new Date();f.setFullYear(f.getFullYear()+1);c.endDate=f}b()}]).controller("editBack",["$scope","$rootScope","$http",function(l,j,g){var h={};h.productName=[];h.channelNum=[];h.company=[];h.compAbbreviation=[];var c=l;c.isVisi="hidden";c.dateShow="hidden";c.close=function(){$("#inputProductInfo").hide(500);k()};c.verifiedDate=function(){var n=new Date(c.effectiveDate);if(c.effectiveDate){c.endDate=c.effectiveDate;c.endDate.setFullYear(c.effectiveDate.getFullYear()+1)}c.isVisi="hidden"};c.checkDate=function(){var n=new Date(c.effectiveDate);var o=new Date(c.endDate);c.effectiveDate&&(c.effectiveDate=n.getTime());c.endDate&&(c.endDate=o.getTime());c.isVisi="hidden";if(o.getTime()<(n.getTime()+1000*3600*24*365)){console.log(o.getTime());c.dateShow="visible";c.dateMsg="结束日期必须大于生效日期+1年"}else{c.dateShow="hidden";c.dateMsg=""}c.effectiveDate=n.toLocaleDateString().replace(/\//g,"-");c.endDate=o.toLocaleDateString().replace(/\//g,"-")};var b=false;c.veriPrice="hidden";c.verifiedPrice=function(){if(c.price){b=/^^(\d)*(.)?(\d)*$/.test(c.price);if(!b){c.veriPrice="visible";c.priceAlert="单价必须为数字!!"}else{c.veriPrice="hidden";c.priceAlert=""}}console.log(b)};var d=false;c.verifiedInstall=function(){if(c.installCount){installMsg=/^(\d)*$/.test(c.installCount);if(!installMsg){c.isVisi="visible";c.isSucc="安装量必须为数字或整数"}else{c.isVisi="hidden";c.isSucc=""}}};l.firstInsertIndex=[];l.newAddData=[];var a=[];c.save=function(){var n={};m();if(l.productName&&l.channelNum&&l.company&&l.compAbbreviation&&l.cooperateType&&b&&installMsg&&c.effectiveDate){g.get("data/insertDataAll.php?proName="+l.productName+"&channelName="+l.channelNum+"&company="+l.company+"&compabbr="+l.compAbbreviation+"&coopType="+l.cooperateType+"&price="+l.price+"&installCount="+l.installCount+"&effeDate="+l.effectiveDate.getTime()+"&endDate="+l.endDate.getTime()).success(function(o){console.log(o);if(o.msg=="Insert Succ!"){c.isVisi="visible";l.isSucc="输入成功!!!";l.firstInsertIndex.push(o.did);g.get("data/returnNewAdd.php?did="+o.did).success(function(p){console.log(p);l.newAddData.push(p);l.arrSort(l.newAddData,"effectiveDate");l.products=l.newAddData;a.concat(l.newAddData);a.push(p)});l.saveInputProductInfo()}else{l.isVisi="visible";l.isSucc="输入有误!!!"}})}else{l.isVisi="visible";l.isSucc="漏输入或输入有误或格式不对!!"}l.clearSearchHistroy()};function k(){l.productName="";l.channelNum="";l.company="";l.compAbbreviation="";l.price="";l.installCount=""}document.querySelector("#inputProductInfo").addEventListener("click",function(){$("input.regInput").next().hide()});function i(){c.effectiveDate=new Date()}i();function e(){var n=new Date();n.setFullYear(n.getFullYear()+1);c.endDate=n}e();function f(p){var n=new Date(p);var o=n.setFullYear(n.getFullYear()+1);return o}function m(){switch(l.cooperateType){case"0":l.cooperateType="CPA";break;case"1":l.cooperateType="CPC";break;case"2":l.cooperateType="CPI";break;case"3":l.cooperateType="CPT";break}}}]).controller("editData",["$scope","$rootScope","$http","$timeout",function(l,j,h,d){var a=[];var n=location.href;n.lastIndexOf("?")>=0&&(l.uname=n.substring(location.href.lastIndexOf("?")+1));l.editable=true;l.autoComplete="off";if(l.uname!="apy"){console.log(l.uname);h.get("data/getProducts.php?name="+j.uname).success(function(o){l.arrSort(o,"effectiveDate");l.products=o;j.products=l.products})}else{h.get("data/getAllProducts.php").success(function(o){var o=c(o);l.arrSort(o,"effectiveDate");l.products=o;j.products=l.products;a=l.products})}function c(p){var r=[p[0]];for(var q=1;q<p.length;q++){for(var o=0;o<r.length;o++){if(p[q].company==r[o].company){parseInt(p[q].effectiveDate)>parseInt(r[o].effectiveDate)&&(r[o]=p[q]);break}}if(o==r.length){r.push(p[q])}}return r}f();l.changeDis=function(){l.editable=false;l.autocomplete="on"};l.refresh=function(){l.clearSearchHistroy();f()};function f(){if(l.uname!="apy"){console.log(l.uname);h.get("data/getProducts.php?name="+j.uname).success(function(o){j.arrSort(o,"effectiveDate");l.products=o;j.products=l.products})}else{h.get("data/getAllProducts.php").success(function(o){var o=c(o);l.arrSort(o,"effectiveDate");l.products=o;j.products=l.products})}}var e={};$("#table-data").on("click","[sort-by]",function(p){var o=$(this).attr("sort-by");e[o]=e[o]||0;e[o]++;var q=e[o]%2;l.products.sort(function(s,r){if(o=="installCount"||o=="price"){return q?s[o]-r[o]:r[o]-s[o]}else{return q?s[o].localeCompare(r[o]):r[o].localeCompare(s[o])}});l.$apply()});l.searchData=function(){if(l.productName||l.channelNum||l.company||l.cooperateType){b();console.log(l.productName);var o="productName="+l.productName+"&channelNum="+l.channelNum+"&company="+l.company+"&cooperateType="+l.cooperateType;h.get("data/newSelectData.php?"+o).success(function(p){console.log(p);l.products=p;l.total=l.getInstallTotal(l.products);if(!p.length){console.log("没查找到符合你要求的数据!!");$("#selectAlert").fadeIn(500)}})}};function b(){if(!l.productName){l.productName=""}if(!l.channelNum){l.channelNum=""}if(!l.company){l.company=""}if(!l.cooperateType){l.cooperateType=""}}l.saveEditData=function(o){if(l.editable==false&&l.cooperateVerified&&l.priceVerified){var p=l.products[o].productName+"&channelNum="+l.products[o].channelNum+"&cooperateType="+l.products[o].cooperateType.toUpperCase()+"&company="+l.products[o].company+"&price="+l.products[o].price+"&did="+l.products[o].did;h.get("data/saveEdit_Table.php?productName="+p).success(function(s){var t=$("#table-data tbody tr").eq(o);if(s=="Update Succ!"){console.log("修改成功");var r=t.css("background");t.css("background","#81E3D6");d(function(){t.css("background",r)},5000)}else{var q=t.css("color");t.css("color","#f00");d(function(){t.css("color",q);l.abandon(o)},5000)}})}};l.verifiedCooperate=function(o){var p=["CPA","CPC","CPI","CPT"];if(p.indexOf(l.products[o].cooperateType.toUpperCase())<0){l.verifiedDataMsg="合作类型只能从:CPA,CPC,CPI,CPT中选择一种.";$("#verifiedData").show(500)}else{l.cooperateVerified=true}};l.verifiedPrice=function(o){if(!/\d/g.test(l.products[o].price)){l.verifiedDataMsg="输入的数据类型不对.";$("#verifiedData").show(500)}else{l.priceVerified=true}};l.closeVerifiedData=function(){$("#verifiedData").hide(500)};l.abandon=function(o){if(!l.editable){console.log(o);console.log(l.products[o].did);console.log(l.products,a);console.log(l.products.length,a.length);var q=l.products[o].did;var p=k(q,a);console.log(p);console.log(a[p].installCount);l.products[o].installCount=a[p].installCount;l.editable=true}};function k(p,q){for(var o=0;o<q.length;o++){console.log(q[o].did);if(q[o].did==p){return o}}}document.querySelector("#editContent").addEventListener("click",function(){$("input.regInput").next().hide()});l.isShow="hidden";l.firstInsertIndex=[];l.newAddData=[];l.save=function(){var o={};console.log(l.cooperateType);m();if(l.productName&&l.channelNum&&l.company&&l.compAbbreviation&&l.cooperateType&&l.price&&l.effectiveDate&&l.endDate){if((l.effectiveDate.getTime()+1000*3600*24*365)<=l.endDate.getTime()&&/\d/g.test(parseInt(l.price))){h.get("data/insertData02.php?proName="+l.productName+"&channelName="+l.channelNum+"&company="+l.company+"&compabbr="+l.compAbbreviation+"&coopType="+l.cooperateType+"&price="+l.price+"&effeDate="+l.effectiveDate.getTime()+"&endDate="+l.endDate.getTime()).success(function(p){console.log(p);if(p.msg=="Insert Succ!"){l.isShow="visible";l.insertMsg="输入成功!!!";l.firstInsertIndex.push(p.did);h.get("data/returnNewAdd.php?did="+p.did).success(function(q){console.log(q);l.newAddData.push(q);l.arrSort(l.newAddData,"effectiveDate");l.products=l.newAddData;a.concat(l.newAddData);a.push(q);console.log(a,a.length)})}else{l.isShow="visible";l.insertMsg="输入有误!!!"}})}else{l.isShow="visible";l.insertMsg="输入有误或格式不对!!"}}else{l.isShow="visible";l.insertMsg="漏输入或输入有误或格式不对!!"}l.clearSearchHistroy()};l.close=function(){$("#editContent").hide(500);l.clearSearchHistroy()};function m(){switch(l.cooperateType){case"0":l.cooperateType="CPA";break;case"1":l.cooperateType="CPC";break;case"2":l.cooperateType="CPI";break;case"3":l.cooperateType="CPT";break}}function i(){l.effectiveDate=new Date()}i();function g(){var o=new Date();o.setFullYear(o.getFullYear()+1);l.endDate=o}g();l.clearSearchHistroy=function(){l.productName="";l.channelNum="";l.cooperateType="";l.company="";l.compAbbreviation="";l.price=""}}]).controller("resetPwd",["$scope","$http",function(a,b){a.pwdAlert=true;a.isUser="hidden";a.resetSucc="hidden";a.$watch("uname",function(){});a.close=function(){$("#resetPwd").hide(500)};a.checkIsUser=function(){var c=/^[a-zA-Z0-9]+?/;console.log(c.test(a.uname));if(c.test(a.uname)){console.log(a.uname);b.get("data/checkIsUser.php?uname="+a.uname).success(function(d){console.log(d);if(d=="user is being"){a.isUser="hidden";a.isUserMsg=""}else{a.isUser="visible";a.isUserMsg="该用户不存在!!请重新输入"}})}else{a.isUser="visible";a.isUserMsg="用户名不能包含汉字"}};a.checkIpntPwd=function(){console.log(a.isUserMsg);if(a.firstPwd!=a.secondPwd){a.pwdAlert=false}else{if(a.firstPwd.length>=6&&a.isUserMsg==""){b.get("data/changePwd.php?uname="+a.uname+"&pwd="+a.encipher(a.secondPwd)).success(function(c){});a.resetSucc="visible";a.resetSuccess="密码更改成功!!!";a.clearAllPwd()}}};a.changeResetmsg=function(){a.resetSuccess=""};a.clearAllPwd=function(){a.firstPwd="";a.secondPwd=""}}]);